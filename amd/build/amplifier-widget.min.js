define(["jquery","mod_amplifier/controller"],function(f,h){function r(){k=f(this).parent().parent(),e=f(this).parent().parent().next(),k.addClass("d-none"),e.removeClass("d-none")}function s(){(k=f(this).parent().parent()).parent().addClass("d-none");var e=f(this).attr("data-goalid"),t=f("#amplifier-user-goal-"+e).find("input[type=radio][name=reminder-frequency-options]:checked");let a=0;void 0!==t.val()&&("daily"===t.val()?a=0:"weekly"===t.val()?a=1:"monthly"===t.val()&&(a=2));var t=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.startdate-day option:selected").val(),i=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.startdate-month option:selected").val(),n=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.startdate-year option:selected").val(),d=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.startdate-hour option:selected").val(),r=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.startdate-minute option:selected").val(),s=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.enddate-day option:selected").val(),o=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.enddate-month option:selected").val(),l=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.enddate-year option:selected").val(),c=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.enddate-hour option:selected").val(),u=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.enddate-minute option:selected").val(),p=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.reminder-hour option:selected").val(),m=f("#amplifier-user-goal-"+e).find(".user-goal-reminder select.reminder-minute option:selected").val(),n=Date.parse(n+`-${i}-${t}T${d}:${r}:00`),i=Date.parse(l+`-${o}-${s}T${c}:${u}:00`);h.saveReminder({startdate:n,enddate:i,reminderhour:parseInt(p),reminderminute:parseInt(m),frequency:a,lastnotificationdate:0,goal:e,user:v,course:y,coursemodule:g,instance:$,participantcode:q})}function o(){(k=f(this).parent().parent()).addClass("d-none"),k.parent().parent().addClass("d-none");var e=f(this).attr("data-goalid");let a=[];f("#amplifier-user-goal-"+e).find(".amplifier-user-response-input").each((e,t)=>{a.push(f(t).val())}),h.submitReflections({reflectiondate:Date.now(),reflections:JSON.stringify(a),goal:e,user:v,course:y,coursemodule:g,instance:$,participantcode:q})}var l,v,y,g,$,q,k,e;return{init:function(e,t,a,i,n){var d=f(`#amplifier-widget-${t}-${a}-`+i);v=e,y=t,g=a,$=i,q=n,f(l=d).find(".topic-card .user-goal-reminder").each(function(){var e,t,a,i,n,d,r,s,o,l,c,u;!f(this)[0].hasAttribute("data-reminderfrequency")||0==(u=f(this).attr("data-reminderfrequency"))?(f(this).find("input[type=radio][name=reminder-frequency-options][id=option_daily]").attr("checked","checked"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_daily]").parent().addClass("active"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_weekly]").parent().removeClass("active"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_monthly]").parent().removeClass("active")):1==u?(f(this).find("input[type=radio][name=reminder-frequency-options][id=option_weekly]").attr("checked","checked"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_daily]").parent().removeClass("active"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_weekly]").parent().addClass("active"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_monthly]").parent().removeClass("active")):2==u&&(f(this).find("input[type=radio][name=reminder-frequency-options][id=option_monthly]").attr("checked","checked"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_daily]").parent().removeClass("active"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_weekly]").parent().removeClass("active"),f(this).find("input[type=radio][name=reminder-frequency-options][id=option_monthly]").parent().addClass("active")),(f(this)[0].hasAttribute("data-startdate-day")?(u=f(this).attr("data-startdate-day"),e=f(this).attr("data-startdate-month"),t=f(this).attr("data-startdate-year"),a=f(this).attr("data-startdate-hour"),i=f(this).attr("data-startdate-minute"),n=f(this).attr("data-enddate-day"),d=f(this).attr("data-enddate-month"),r=f(this).attr("data-enddate-year"),s=f(this).attr("data-enddate-hour"),o=f(this).attr("data-enddate-minute"),l=f(this).attr("data-reminder-hour").toString().padStart(2,"0"),c=f(this).attr("data-reminder-minute").toString().padStart(2,"0"),f(this).find(`select.startdate-day option[value=${u}]`).attr("selected","selected"),f(this).find(`select.startdate-month option[value=${e}]`).attr("selected","selected"),f(this).find(`select.startdate-year option[value=${t}]`).attr("selected","selected"),f(this).find(`select.startdate-hour option[value=${a}]`).attr("selected","selected"),f(this).find(`select.startdate-minute option[value=${i}]`).attr("selected","selected"),f(this).find(`select.enddate-day option[value=${n}]`).attr("selected","selected"),f(this).find(`select.enddate-month option[value=${d}]`).attr("selected","selected"),f(this).find(`select.enddate-year option[value=${r}]`).attr("selected","selected"),f(this).find(`select.enddate-hour option[value=${s}]`).attr("selected","selected"),f(this).find(`select.enddate-minute option[value=${o}]`).attr("selected","selected"),f(this).find(`select.reminder-hour option[value=${l}]`).attr("selected","selected"),f(this).find(`select.reminder-minute option[value=${c}]`)):(u=new Date,f(this).find(`select.startdate-day option[value=${u.getDate()}]`).attr("selected","selected"),f(this).find(`select.startdate-month option[value=${u.getMonth()+1}]`).attr("selected","selected"),f(this).find(`select.startdate-year option[value=${u.getFullYear()}]`).attr("selected","selected"),f(this).find(`select.startdate-hour option[value=${u.getHours()}]`).attr("selected","selected"),f(this).find("select.startdate-minute option[value=0]").attr("selected","selected"),f(this).find(`select.enddate-day option[value=${u.getDate()+7}]`).attr("selected","selected"),f(this).find(`select.enddate-month option[value=${u.getMonth()+1}]`).attr("selected","selected"),f(this).find(`select.enddate-year option[value=${u.getFullYear()}]`).attr("selected","selected"),f(this).find(`select.enddate-hour option[value=${u.getHours()}]`).attr("selected","selected"),f(this).find("select.enddate-minute option[value=0]").attr("selected","selected"),f(this).find(`select.reminder-hour option[value=${u.getHours()}]`).attr("selected","selected"),f(this).find("select.reminder-minute option[value=0]"))).attr("selected","selected")}),f(l).find(".next.action-button.reflective-question").click(r),f(l).find(".submit.action-button.reflection-submit").click(o),f(l).find(".reminder-dropdown-toggle").on("click",function(){f("#"+f(this).attr("data-target")).toggleClass("d-none")}),f(l).find(".reflection-dropdown-toggle").on("click",function(){f("#"+f(this).attr("data-target")).toggleClass("d-none"),f(`#${f(this).attr("data-target")} .user-goal-reflection fieldset`).first().toggleClass("d-none")}),f(l).find(".user-goal-reminder-save").on("click",s)}}});