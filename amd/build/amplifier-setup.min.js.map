{"version":3,"file":"amplifier-setup.min.js","sources":["../src/amplifier-setup.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Amplifier Widget Setup\n *\n * @module    mod_amplifier/amplifier-setup\n * @copyright 2020 Know-Center GmbH\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'mod_amplifier/controller'], function($, Controller) {\n\n    /**\n     * Course, Course module, course module instance and user identifiers\n     */\n    var courseId, courseModuleId, instanceId, userId;\n\n    /**\n     * References to the currcent, previous and next fieldsets within the amplifier setup\n     */\n    var currentFieldset, nextFieldset, previousFieldset;\n\n    /**\n     * The users participant code\n     */\n    var participantCode = \"TODO insert participant code here\";\n\n    /**\n     * The user reflections\n     */\n    var reflections = [];\n\n    /**\n     * The user selected learning goals\n     */\n    var learningGoals = [];\n\n    /**\n     * Initialising the setup of the amplifier widget\n     *\n     * @param {object} paramCourseId The course identifier\n     * @param {object} paramCourseModuleId The course module identifier\n     * @param {object} paramInstanceId The course module instance identifier\n     * @param {object} paramUserId The user identifier\n     */\n    const init = (paramCourseId, paramCourseModuleId, paramInstanceId, paramUserId) => {\n\n        courseId = paramCourseId;\n        courseModuleId = paramCourseModuleId;\n        instanceId = paramInstanceId;\n        userId = paramUserId;\n\n        let $amplifierSetupRoot = $(`#amplifier-widget-${courseId}-${courseModuleId}-${instanceId}`);\n\n        $amplifierSetupRoot.find(\".amplifier-setup .next\").click(handleNextButtonClick);\n\n        $amplifierSetupRoot.find(\".amplifier-setup .previous\").click(handlePreviousButtonClick);\n\n        $amplifierSetupRoot.find(\".amplifier-setup .amplifier-submit-setup\").click(handleSubmitButtonClick);\n\n        $amplifierSetupRoot.find(\".amplifier-setup .predefined-learning-goal-check\").click(handleLearningGoalClick);\n\n        $amplifierSetupRoot.find(\".amplifier-setup .participantcode-input\").change(handleParticipantCodeChange);\n\n    };\n\n    /**\n     * Next button click handler\n     */\n    var handleNextButtonClick = function() {\n\n        currentFieldset = $(this).parent().parent();\n        nextFieldset = $(this).parent().parent().next();\n\n        if ($(this).hasClass('participantcode')) {\n            participantCode = $(this).parent().parent().find(\".participantcode-input\").val();\n        }\n        if ($(this).hasClass('reflective-question')) {\n            let userResponse = $(this).parent().parent().find(\".amplifier-user-response-input\").val();\n            let topicId = $(this).parent().parent().find(\".amplifier-user-response-input\").attr(\"data-topicid\");\n            let goalId = $(this).parent().parent().find(\".amplifier-user-response-input\").attr(\"data-goalid\");\n            reflections.push({userResponse: userResponse, topicid: topicId, goalid: goalId});\n        }\n        if ($(this).hasClass('learning-goals')) {\n            $(\".predefined-learning-goal-check\").each((idx, element) => {\n                if ($(element).is(':checked')) {\n                    let topicId = $(element).attr(\"data-topicid\");\n                    let goalId = $(element).attr(\"data-goalid\");\n                    learningGoals.push({topicid: topicId, goalid: goalId});\n                }\n            });\n\n        }\n\n        // Show the next fieldset\n        currentFieldset.addClass(\"d-none\");\n        nextFieldset.removeClass(\"d-none\");\n        nextFieldset.show();\n        currentFieldset.hide();\n    };\n\n    /**\n     * Previous button click handler\n     */\n    var handlePreviousButtonClick = function() {\n        currentFieldset = $(this).parent().parent();\n        previousFieldset = $(this).parent().parent().prev();\n\n        // Show the previous fieldset\n        currentFieldset.addClass(\"d-none\");\n        previousFieldset.removeClass(\"d-none\");\n        previousFieldset.show();\n        currentFieldset.hide();\n    };\n\n    /**\n     * Amplifier setup submit button handler\n     */\n    var handleSubmitButtonClick = function() {\n\n        // Submit the settings and trigger loading landing page of amplifier widget\n        Controller.submitSetup({\n            courseid: courseId,\n            userid: userId,\n            coursemoduleid: courseModuleId,\n            instanceid: instanceId,\n            participantcode: participantCode,\n            reflections: JSON.stringify(reflections),\n            learninggoals: JSON.stringify(learningGoals)\n        })\n            .then(\n                function() {\n                    // Reload document to show amplifier widget\n                    location.reload();\n                    return;\n                }\n            )\n            .catch(function(error) {\n                throw new Error(error);\n            });\n    };\n\n    /**\n     * Learning goal check box selection handler\n     */\n    var handleLearningGoalClick = function() {\n        let checkedCount = 0;\n        $(\".predefined-learning-goal-check\").each((idx, element) => {\n            if ($(element).is(':checked')) {\n                checkedCount++;\n            }\n        });\n        if (checkedCount > 0 && checkedCount <= 5) {\n            $(this).closest('fieldset').find('button.next.action-button').prop('disabled', false);\n            $(this).closest('fieldset').find('button.next.action-button').css('opacity', '1');\n        } else {\n            $(this).closest('fieldset').find('button.next.action-button').prop('disabled', true);\n            $(this).closest('fieldset').find('button.next.action-button').css('opacity', '.5');\n        }\n    };\n\n\n    /**\n     * Participant code next button handler\n     */\n    var handleParticipantCodeChange = function() {\n\n        let participantCode = $(this).val();\n        if (participantCode.length == 5) {\n            $(this).closest('fieldset').find('button.next.action-button').prop('disabled', false);\n            $(this).closest('fieldset').find('button.next.action-button').css('opacity', '1');\n        } else {\n            $(this).closest('fieldset').find('button.next.action-button').prop('disabled', true);\n            $(this).closest('fieldset').find('button.next.action-button').css('opacity', '.5');\n        }\n\n    };\n\n    return {\n        init: init\n    };\n});\n\n\n"],"names":["define","$","Controller","courseId","courseModuleId","instanceId","userId","currentFieldset","nextFieldset","previousFieldset","participantCode","reflections","learningGoals","handleNextButtonClick","this","parent","next","hasClass","find","val","userResponse","topicId","attr","goalId","push","topicid","goalid","each","idx","element","is","addClass","removeClass","show","hide","handlePreviousButtonClick","prev","handleSubmitButtonClick","submitSetup","courseid","userid","coursemoduleid","instanceid","participantcode","JSON","stringify","learninggoals","then","location","reload","catch","error","Error","handleLearningGoalClick","checkedCount","closest","prop","css","handleParticipantCodeChange","length","init","paramCourseId","paramCourseModuleId","paramInstanceId","paramUserId","$amplifierSetupRoot","click","change"],"mappings":"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"}