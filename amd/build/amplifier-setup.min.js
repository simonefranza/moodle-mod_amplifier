define(["jquery","mod_amplifier/controller"],function(s,t){function a(){var t,i,e;n=s(this).parent().parent(),h=s(this).parent().parent().next(),s(this).hasClass("participantcode")&&(b=s(this).parent().parent().find(".participantcode-input").val()),s(this).hasClass("reflective-question")&&(t=s(this).parent().parent().find(".amplifier-user-response-input").val(),i=s(this).parent().parent().find(".amplifier-user-response-input").attr("data-topicid"),e=s(this).parent().parent().find(".amplifier-user-response-input").attr("data-goalid"),g.push({userResponse:t,topicid:i,goalid:e})),s(this).hasClass("learning-goals")&&s(".predefined-learning-goal-check").each((t,i)=>{var e;s(i).is(":checked")&&(e=s(i).attr("data-topicid"),i=s(i).attr("data-goalid"),m.push({topicid:e,goalid:i}))}),n.addClass("d-none"),h.removeClass("d-none"),h.show(),n.hide()}function o(){n=s(this).parent().parent(),i=s(this).parent().parent().prev(),n.addClass("d-none"),i.removeClass("d-none"),i.show(),n.hide()}function r(){t.submitSetup({courseid:p,userid:u,coursemoduleid:l,instanceid:f,participantcode:b,reflections:JSON.stringify(g),learninggoals:JSON.stringify(m)}).then(function(){location.reload()}).catch(function(t){throw new Error(t)})}function d(){let e=0;s(".predefined-learning-goal-check").each((t,i)=>{s(i).is(":checked")&&e++}),0<e&&e<=5?(s(this).closest("fieldset").find("button.next.action-button").prop("disabled",!1),s(this).closest("fieldset").find("button.next.action-button").css("opacity","1")):(s(this).closest("fieldset").find("button.next.action-button").prop("disabled",!0),s(this).closest("fieldset").find("button.next.action-button").css("opacity",".5"))}function c(){5==s(this).val().length?(s(this).closest("fieldset").find("button.next.action-button").prop("disabled",!1),s(this).closest("fieldset").find("button.next.action-button").css("opacity","1")):(s(this).closest("fieldset").find("button.next.action-button").prop("disabled",!0),s(this).closest("fieldset").find("button.next.action-button").css("opacity",".5"))}var p,l,f,u,n,h,i,b="TODO insert participant code here",g=[],m=[];return{init:(t,i,e,n)=>{u=n;n=s(`#amplifier-widget-${p=t}-${l=i}-`+(f=e));n.find(".amplifier-setup .next").click(a),n.find(".amplifier-setup .previous").click(o),n.find(".amplifier-setup .amplifier-submit-setup").click(r),n.find(".amplifier-setup .predefined-learning-goal-check").click(d),n.find(".amplifier-setup .participantcode-input").change(c)}}});